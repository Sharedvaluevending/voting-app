<%- include('partials/header') %>

<main class="chart-page">
  <div class="chart-header">
    <h1><%= coinName %> (<%= symbol %>) â€“ Chart</h1>
    <a href="/coin/<%= coinId %>" class="btn btn-outline btn-sm">Back to <%= coinName %></a>
  </div>

  <% if (entry != null || sl != null || tp1 != null || tp2 != null || tp3 != null) { %>
  <div class="trade-levels-bar">
    <span class="levels-title">Trade levels:</span>
    <% if (entry != null) { %><span class="level-badge entry">Entry $<%= entry.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 }) %></span><% } %>
    <% if (sl != null) { %><span class="level-badge sl">SL $<%= sl.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 }) %></span><% } %>
    <% if (tp1 != null) { %><span class="level-badge tp">TP1 $<%= tp1.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 }) %></span><% } %>
    <% if (tp2 != null) { %><span class="level-badge tp">TP2 $<%= tp2.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 }) %></span><% } %>
    <% if (tp3 != null) { %><span class="level-badge tp">TP3 $<%= tp3.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 }) %></span><% } %>
  </div>
  <% } %>

  <div class="chart-container" id="tv-chart-container">
    <div class="tradingview-widget-container" style="width:100%;height:100%;">
      <div id="tradingview_widget" style="width:100%;height:100%;"></div>
    </div>
  </div>
</main>

<style>
.chart-page { padding: 1rem; max-width: 100%; box-sizing: border-box; }
.chart-header { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 1rem; }
.chart-header h1 { margin: 0; font-size: 1.25rem; color: #e5e7eb; }
.trade-levels-bar { display: flex; align-items: center; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; padding: 0.5rem 0.75rem; background: rgba(30,41,59,0.6); border-radius: 8px; }
.levels-title { color: #94a3b8; font-size: 0.875rem; margin-right: 0.5rem; }
.level-badge { font-size: 0.8rem; padding: 0.25rem 0.5rem; border-radius: 4px; }
.level-badge.entry { background: rgba(59, 130, 246, 0.3); color: #93c5fd; }
.level-badge.sl { background: rgba(239, 68, 68, 0.3); color: #fca5a5; }
.level-badge.tp { background: rgba(34, 197, 94, 0.3); color: #86efac; }
.chart-container { position: relative; width: 100%; height: calc(100vh - 140px); min-height: 400px; border-radius: 8px; overflow: hidden; background: #0f172a; }
</style>

<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script type="text/javascript">
new TradingView.widget({
  "container_id": "tradingview_widget",
  "autosize": true,
  "symbol": "<%= tvSymbol %>",
  "interval": "60",
  "timezone": "Etc/UTC",
  "theme": "dark",
  "style": "1",
  "locale": "en",
  "toolbar_bg": "#0f172a",
  "enable_publishing": false,
  "hide_side_toolbar": false,
  "allow_symbol_change": true,
  "save_image": false,
  "studies": ["MASimple@tv-basicstudies", "RSI@tv-basicstudies", "MACD@tv-basicstudies"],
  "show_popup_button": true,
  "popup_width": "1000",
  "popup_height": "650"
});
</script>

<%- include('partials/footer') %>
